steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'fury/ci', '.']
  timeout: 300s
  id: 'build'

- name: 'gcr.io/cloud-builders/docker'
  args: ['run', '-w', '/build', '-t', 'fury/ci', 'make', 'test']
  timeout: 300s
  waitFor:
    - build
  id: 'unittests'

- name: 'gcr.io/cloud-builders/docker'
  args: ['run', '-u', 'bash_user', '-w', '/home/bash_user', '-t', 'fury/ci', '/integration']
  timeout: 300s
  waitFor:
    - build
  id: 'integration'

- name: 'gcr.io/cloud-builders/docker'
  args: ['run', '-u', 'bash_user', '-w', '/home/bash_user', '-t', 'fury/ci', '/community']
  timeout: 600s
  waitFor:
    - build
  id: 'community'

options:
  machineType: 'N1_HIGHCPU_8'

timeout: 1000s
